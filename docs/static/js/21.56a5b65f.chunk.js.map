{"version":3,"sources":["context.tsx","utils/helper.ts","pages/context/index.tsx"],"names":["__webpack_require__","d","__webpack_exports__","ThemeContext","react__WEBPACK_IMPORTED_MODULE_0__","createContext","setCookie","getCookie","compressImage","key","value","domain","expire","expires","date","Date","days","setTime","getTime","toUTCString","cookie","concat","encodeURIComponent","console","log","document","arr","reg","RegExp","match","decodeURIComponent","JSON","parse","e","imgSrc","width","arguments","length","undefined","mimeType","quality","Promise","resolve","reject","img","Image","src","onload","scale","height","canvas","createElement","ctx","getContext","drawImage","toBlob","blob","Toolbar","this","props","type","context","react__WEBPACK_IMPORTED_MODULE_6__","React","Tooltip","_context__WEBPACK_IMPORTED_MODULE_7__","Consumer","contextType","Context","_this","Object","_Users_admin_Documents_projects_webapp_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_1__","_Users_admin_Documents_projects_webapp_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_3__","_Users_admin_Documents_projects_webapp_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_4__","call","onChangeContext","setState","onUploadFile","event","file","target","files","fileName","name","split","fileRead","FileReader","that","_Users_admin_Documents_projects_webapp_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_0__","onloadend","_this2","result","originImage","then","res","newImage","File","lastModified","now","RD","compressedImage","readAsDataURL","catch","err","state","other","_this$state","alt","multiple","onChange","onClick","Provider"],"mappings":"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","file":"static/js/21.56a5b65f.chunk.js","sourcesContent":["import { createContext } from 'react'\n\nexport const ThemeContext = createContext('globalContext-default')","// 最好后台全部包好，前端只根据错误码做交互的东西\nconst UNDEFINED_TEXT = \"未定义错误码\";\nconst ERROR_CODE_TO_MESSAGE: any = {\n  pegasus: {\n    1: \"1\",\n    2: \"2\",\n    3: \"3\",\n  },\n  unicorn: {\n    1: \"1\",\n    2: \"2\",\n    3: \"3\",\n  },\n};\n/*\n    一、cookie包装工具\n*/\n// cookie值不能存在逗号，分号，空格等特殊符号；\n// encodeURIComponent会编码这些特殊符号；但是JSON.stringify不会编码这些特殊符号\nexport function setCookie(\n  key: string,\n  value: string,\n  domain?: string,\n  expire?: number\n) {\n  let expires = \"\";\n  let date = new Date();\n  let days = expire || 30;\n  date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000);\n  expires = \"; expires=\" + date.toUTCString();\n\n  let cookie = domain\n    ? `${key}=${encodeURIComponent(value)}${expires}; path=/; domain=${domain}`\n    : `${key}=${encodeURIComponent(value)}${expires}; path=/`;\n  console.log(\"cookie===>\", cookie);\n  document.cookie = cookie;\n}\n\nexport function setCookieWithout(key: string, value: string, path?: string) {\n  console.log(\"path===>\", path);\n\n  document.cookie = `${key}=${encodeURIComponent(value)};path=${\n    path ? path : \"/\"\n  }`;\n}\n\nexport function getCookie(key: string) {\n  let arr,\n    reg = new RegExp(\"(^| )\" + key + \"=([^;]*)(;|$)\");\n  arr = document.cookie.match(reg);\n\n  if (!arr) {\n    return null;\n  } else {\n    let value = decodeURIComponent(arr[2]);\n    try {\n      return value ? JSON.parse(value) : null;\n    } catch (e) {\n      return value;\n    }\n  }\n}\n/*\n    二、错误码处理工具\n */\nexport function getMsgWithCode(name: string = \"pegasus\", code: number) {\n  const code_to_msg = ERROR_CODE_TO_MESSAGE[name];\n  if (code_to_msg === undefined) {\n    return UNDEFINED_TEXT;\n  }\n\n  if (code_to_msg[code] === undefined) {\n    return UNDEFINED_TEXT;\n  }\n\n  return code_to_msg[code];\n}\n\n/*\n    三、LOG工具\n */\nexport function log(msg: any) {\n  console.log(\"%c \" + msg + \" \", \"background: #00a3fe;color: #fff\");\n}\n\nexport function warning(msg: any) {\n  console.log(\"%c \" + msg + \" \", \"background: #ffff00;color: #000\");\n}\n\nexport function error(msg: any) {\n  console.log(\"%c \" + msg + \" \", \"background: #ff0000;color: #fff\");\n}\n/*\n    四、URL工具\n */\nexport function getUrlParamByName(name: string, url?: string) {\n  const reg = new RegExp(`[?&]${name}(=([^&#]*)|&|#|$)`);\n  if (!url) {\n    url = window.location.href;\n  }\n  let res = url.match(reg);\n  if (res != null && res[2]) {\n    return decodeURIComponent(res[2]);\n  }\n  return undefined;\n}\n\nexport function compressImage(\n  imgSrc: string,\n  width: number = 300,\n  mimeType: string = \"image/jpeg\",\n  quality: number = 0.8\n): Promise<Blob> {\n  return new Promise((resolve, reject) => {\n    const img = new Image();\n    img.src = imgSrc;\n    img.onload = function () {\n      const scale = img.height / img.width;\n      const canvas = document.createElement(\"canvas\");\n      // 使用目标图像大小指定画布大小，默认是300*150，会出现黑边\n      canvas.width = width;\n      canvas.height = width * scale;\n      const ctx = canvas.getContext(\"2d\");\n      // canvas画布大小\n      // drawImage将图片在画布上以width和width*scale为尺寸进行绘制\n      ctx && ctx.drawImage(img, 0, 0, width, width * scale);\n      canvas.toBlob(\n        function (blob: any) {\n          if (blob) {\n            resolve(blob);\n          } else {\n            reject();\n          }\n        },\n        mimeType,\n        quality\n      );\n    };\n  });\n}\n","import * as React from 'react';\nimport { ThemeContext } from '../../context'\nimport { compressImage } from \"@/utils/helper\"\ninterface IProps { }\ninterface IState {\n\tcontext: string\n\toriginImage: string\n\tcompressedImage: string\n\tother: string\n}\n// context消费方式1：Class.contextType\nclass Toolbar extends React.Component<any, never> {\n\tstatic contextType = ThemeContext\n\n\trender() {\n\t\tconsole.log(`${this.props.type}-Toolbar=======>`, this.context)\n\t\treturn (\n\t\t\t<div>\n\t\t\t\tToobar\n\t\t\t</div>\n\t\t)\n\t}\n}\n// context消费方式2：Context.Consumer\nfunction Tooltip(props: any) {\n\treturn (\n\t\t<ThemeContext.Consumer>\n\t\t\t{\n\t\t\t\t(context) => {\n\t\t\t\t\tconsole.log(`${props.type}-Tooltip--->`, context)\n\t\t\t\t\treturn <div>\n\t\t\t\t\t\ttooltip\n\t\t\t\t\t</div>\n\t\t\t\t}\n\t\t\t}\n\t\t</ThemeContext.Consumer>\n\t)\n}\n// Context修改方式：Context.Provider\nclass Context extends React.Component<IProps, IState> {\n\tstatic contextType = ThemeContext\n\tconstructor(props: IProps,) {\n\t\tsuper(props);\n\t\tthis.state = {\n\t\t\tcontext: 'Context-default',\n\t\t\toriginImage: \"\",\n\t\t\tcompressedImage: \"\",\n\t\t\tother: \"\"\n\t\t};\n\t}\n\n\tonChangeContext = () => {\n\t\tthis.setState({\n\t\t\tcontext: 'Context-change'\n\t\t})\n\t}\n\tonUploadFile = (event: any) => {\n\t\tconst fileList = event.target.files;\n\t\tconst file = fileList[0]\n\t\tconsole.log(\"origin file===>\", file)\n\t\tconst fileName = (file.name || \"\").split(\".\")[0] || \"\"\n\t\tconst fileRead = new FileReader();\n\t\tconst that = this\n\t\tfileRead.onloadend = function (event) {\n\t\t\tif (this.result) {\n\t\t\t\tthat.setState({\n\t\t\t\t\toriginImage: this.result as string\n\t\t\t\t}, () => {\n\t\t\t\t\tconst mimeType = \"image/jpeg\"\n\t\t\t\t\tconst quality = 0.8\n\t\t\t\t\tcompressImage(this.result as string, 200, mimeType, quality).then((res) => {\n\t\t\t\t\t\tconst newImage = new File([res], fileName, {\n\t\t\t\t\t\t\ttype: mimeType,\n\t\t\t\t\t\t\tlastModified: Date.now()\n\t\t\t\t\t\t})\n\t\t\t\t\t\tconst RD = new FileReader();\n\t\t\t\t\t\tRD.onloadend = function () {\n\t\t\t\t\t\t\tif (this.result) {\n\t\t\t\t\t\t\t\tthat.setState({\n\t\t\t\t\t\t\t\t\tcompressedImage: this.result as string\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tRD.readAsDataURL(res)\n\n\t\t\t\t\t\tconsole.log(\"compressedImage===>\", newImage)\n\t\t\t\t\t}).catch((err: any) => {\n\t\t\t\t\t\tconsole.log(\"图片压缩失败===>\", err)\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t\tfileRead.readAsDataURL(file);\n\t}\n\trender() {\n\t\tconsole.log(\"自己消费默认值Context-render==>\", this.context)\n\t\tconst {\n\t\t\toriginImage,\n\t\t\tcompressedImage\n\t\t} = this.state\n\t\treturn (\n\t\t\t<div>\n\t\t\t\t<div>\n\t\t\t\t\t{\n\t\t\t\t\t\tcompressedImage ? <img src={compressedImage} alt=\"\" /> : null\n\t\t\t\t\t}\n\t\t\t\t\t{\n\t\t\t\t\t\toriginImage ? <img src={originImage} alt=\"\" /> : null\n\t\t\t\t\t}\n\n\t\t\t\t</div>\n\t\t\t\t<input type=\"file\" multiple onChange={this.onUploadFile} />\n\t\t\t\t<button onClick={this.onChangeContext}>\n\t\t\t\t\tchange context\n\t\t\t\t</button>\n\t\t\t\t<Toolbar type=\"first level\" />\n\t\t\t\t<Tooltip type=\"first level\" />\n\t\t\t\t<ThemeContext.Provider value={this.state.context}>\n\t\t\t\t\tContext\n\t\t\t\t\t<Toolbar type=\"child level\" />\n\t\t\t\t\t<Tooltip type=\"child level\" />\n\t\t\t\t</ThemeContext.Provider>\n\t\t\t</div>\n\t\t);\n\t}\n}\nexport default Context;"],"sourceRoot":""}