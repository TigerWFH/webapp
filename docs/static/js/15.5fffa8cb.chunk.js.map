{"version":3,"sources":["pages/x6/components/X6DndGraph/index.module.scss","pages/x6/components/X6ReactTrigger/index.module.scss","pages/x6/components/X6ReactTrigger/index.tsx","pages/x6/components/X6DndGraph/index.tsx","pages/x6/index.tsx"],"names":["module","exports","x6dnd","component","wrapper","stencil","container","toolbar","graph","x6-graph-scroller","title","content","Trigger","_React$Component","_inherits","_super","_createSuper","props","_this","_classCallCheck","this","call","onChange","e","setState","name","target","value","onDelete","editable","state","node","setData","console","log","_createClass","key","nextProps","nextState","hasChanged","_this$state","React","className","styles","placeholder","delete","onClick","defaultProps","width","height","type","Rect","Shape","Circle","Item","Toolbar","Group","MOCKDATA","nodes","id","x","y","label","edges","source","X6DndGraph","stencilContainer","getnerateTreeFromEdges","forEach","edge","parent","prev","next","child","refContainer","refStencil","onGetAll","all","getCells","onAutoLayout","rootNode","getRootNodes","length","_this$graph","root","depthMap","Map","leafCount","getLeafNodes","prevChildren","getNeighbors","outgoing","searchCell","cell","distance","isNode","position","_this$graph2","_parent","offset","getPredecessors","breadthFirst","parentPosition","Array","isArray","count","get","undefined","set","Graph","grid","use","Snapline","enabled","sharp","fromJSON","Stencil","search","keyword","shape","indexOf","notFoundText","collapsable","stencilGraphWidth","stencilGraphHeight","groups","graphHeight","graphOptions","collapsed","getDragNode","options","clone","getDropNode","newNode","size","addPorts","attrs","circle","magnet","appendChild","r","rect","fill","stroke","strokeWidth","text","c","data","c2","stroke-width","r2","r3","c3","ports","customNode","load","style","ref","tooltip","icon","X6","apply","arguments","overflow","connect","x6"],"mappings":"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","file":"static/js/15.5fffa8cb.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"x6dnd\":\"X6DndGraph_x6dnd__34Xov\",\"component\":\"X6DndGraph_component__7q1PX\",\"wrapper\":\"X6DndGraph_wrapper__2AVqN\",\"stencil\":\"X6DndGraph_stencil__21abQ\",\"container\":\"X6DndGraph_container__3ZzDT\",\"toolbar\":\"X6DndGraph_toolbar__2HmC4\",\"graph\":\"X6DndGraph_graph__3O_Ro\",\"x6-graph-scroller\":\"X6DndGraph_x6-graph-scroller__1I59x\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"X6ReactTrigger_container__3lW6w\",\"title\":\"X6ReactTrigger_title__21kuW\",\"content\":\"X6ReactTrigger_content__1yQMJ\"};","import * as React from \"react\";\nimport styles from \"./index.module.scss\";\n\n\nconst LOG_NODE_WIDTH = 40;\nconst LOG_NODE_HEIGHT = 40;\n\ninterface ITrigger {\n\n    width?: number\n    height?: number\n    name?: string\n    content?: string\n    node?: any\n    onDelete?: () => any\n}\nclass Trigger extends React.Component<ITrigger, any, never> {\n    static defaultProps = {\n        width: LOG_NODE_WIDTH,\n        height: LOG_NODE_HEIGHT,\n        name: \"客群\",\n        type: 'consumer',\n        content: 'default content'\n    };\n    constructor(props: any) {\n        super(props);\n        console.log(\"constructor\")\n        this.state = {\n            name: '',\n            editable: false\n        }\n    }\n    shouldComponentUpdate(nextProps: any, nextState: any) {\n        console.log(\"SCU====>\", nextProps, nextState)\n        const { name } = nextState;\n        const oldName = this.state.name;\n        if (name !== oldName) {\n            return true;\n        }\n        const node = this.props.node;\n        if (node) {\n            if (node.hasChanged(\"data\")) {\n                return true;\n            }\n        }\n\n        console.log(\"no-rerender======>\", this.props.node === nextProps.node)\n\n        return false;\n    }\n    componentDidUpdate() {\n        console.log(\"didUpdate======>\", this.props)\n    }\n\n    onChange = (e: any) => {\n        this.setState({\n            name: e.target.value\n        })\n    }\n\n    onDelete = () => {\n        // console.log(\"shanchu\")\n        // const { onDelete } = this.props;\n        // if (typeof onDelete === 'function') {\n        //     onDelete()\n        // }\n        const { editable } = this.state;\n        this.setState({\n            editable: !editable\n        }, () => {\n            const { node } = this.props;\n            // const { data = {} } = node;\n            const { name } = this.state;\n            // data.name = name;\n            node.setData({\n                name\n            })\n        })\n    }\n\n    render() {\n        console.log(\"render=======>\", this.props)\n        const { content } = this.props;\n        const { name, editable } = this.state;\n        return (\n            <div className={styles.container} >\n                <div className={styles.title}>\n                    {\n                        editable ? <input value={name} placeholder=\"请输入新名字\" onChange={this.onChange} /> :\n                            <span className={styles.name}>{name}</span>\n                    }\n                    <button className={styles.delete} onClick={this.onDelete}>\n                        {\n                            editable ? '保存' : '编辑'\n                        }\n                    </button>\n                </div>\n                <div className={styles.content}>\n                    {\n                        content\n                    }\n                </div>\n            </div>\n        );\n    }\n}\n\n\nexport default Trigger;","import * as React from 'react';\nimport { Graph, Shape, Cell } from '@antv/x6';\nimport { Toolbar } from '@antv/x6-react-components';\nimport '@antv/x6-react-shape';\nimport '@antv/x6-react-components/es/menu/style/index.css';\nimport '@antv/x6-react-components/es/toolbar/style/index.css';\nimport { Snapline } from '@antv/x6-plugin-snapline';\n// import { Scroller } from '@antv/x6-plugin-scroller';\n// Stencil依赖@antv/x6-plugin-dnd\nimport { Stencil } from '@antv/x6-plugin-stencil';\nimport styles from './index.module.scss';\nimport Trigger from '../X6ReactTrigger';\n\nconst { Rect, Circle } = Shape;\nconst { Item, Group } = Toolbar;\n\ninterface IX6DndGraphProps {\n  businessType?: string; // 业务类型，不同业务使用不同的图元集合\n}\n/*\n    source是父节点\n    target是子节点\n*/\n\nconst MOCKDATA = {\n  nodes: [\n    {\n      id: 'node1',\n      x: 40,\n      y: 40,\n      width: 80,\n      height: 40,\n      label: 'node1'\n    },\n    {\n      id: 'node2',\n      x: 160,\n      y: 180,\n      width: 80,\n      height: 40,\n      label: 'node2'\n    },\n    {\n      id: 'node3',\n      x: 160,\n      y: 180,\n      width: 80,\n      height: 40,\n      label: 'node3'\n    },\n    {\n      id: 'node4',\n      x: 160,\n      y: 180,\n      width: 80,\n      height: 40,\n      label: 'node4'\n    },\n    {\n      id: 'node5',\n      x: 40,\n      y: 40,\n      width: 80,\n      height: 40,\n      label: 'node5'\n    },\n    {\n      id: 'node6',\n      x: 160,\n      y: 180,\n      width: 80,\n      height: 40,\n      label: 'node6'\n    },\n    {\n      id: 'node7',\n      x: 160,\n      y: 180,\n      width: 80,\n      height: 40,\n      label: 'node7'\n    },\n    {\n      id: 'node8',\n      x: 160,\n      y: 180,\n      width: 80,\n      height: 40,\n      label: 'node8'\n    },\n    {\n      id: 'node8',\n      x: 160,\n      y: 180,\n      width: 80,\n      height: 40,\n      label: 'node8'\n    },\n    {\n      id: 'node9',\n      x: 160,\n      y: 180,\n      width: 80,\n      height: 40,\n      label: 'node9'\n    },\n    {\n      id: 'node10',\n      x: 160,\n      y: 180,\n      width: 80,\n      height: 40,\n      label: 'node10'\n    },\n    {\n      id: 'node11',\n      x: 160,\n      y: 180,\n      width: 80,\n      height: 40,\n      label: 'node11'\n    },\n    {\n      id: 'node12',\n      x: 160,\n      y: 180,\n      width: 80,\n      height: 40,\n      label: 'node12'\n    }\n  ],\n  edges: [\n    {\n      source: 'node1',\n      target: 'node10'\n    },\n    {\n      source: 'node1',\n      target: 'node8'\n    },\n    {\n      source: 'node1',\n      target: 'node3'\n    },\n    {\n      source: 'node1',\n      target: 'node9'\n    },\n    {\n      source: 'node1',\n      target: 'node2'\n    },\n    {\n      source: 'node2',\n      target: 'node4'\n    },\n    {\n      source: 'node2',\n      target: 'node5'\n    },\n    {\n      source: 'node2',\n      target: 'node6'\n    },\n    {\n      source: 'node2',\n      target: 'node7'\n    },\n    {\n      source: 'node9',\n      target: 'node11'\n    },\n    {\n      source: 'node9',\n      target: 'node12'\n    }\n  ]\n};\n\nexport default class X6DndGraph extends React.Component<IX6DndGraphProps, any> {\n  container: HTMLDivElement | null = null;\n  stencilContainer: HTMLDivElement | null = null;\n  private graph: Graph | undefined;\n  stencil: Stencil | undefined;\n  constructor(props: any) {\n    super(props);\n    this.state = {\n      node: null\n    };\n  }\n  getnerateTreeFromEdges = (edges: any[]) => {\n    // let root = null;\n    edges.forEach((edge) => {\n      const parent = {\n        id: edge.source,\n        prev: null,\n        next: null\n      };\n      const child = {\n        id: edge.target,\n        prev: parent,\n        next: null\n      };\n      parent.next = child as any;\n    });\n  };\n  componentDidMount() {\n    this.graph = new Graph({\n      container: this.container as HTMLDivElement,\n      grid: true\n      // snapline: {\n      //   enabled: true,\n      //   sharp: true\n      // },\n      // scroller: {\n      //   enabled: true,\n      //   pageVisible: false,\n      //   pageBreak: false,\n      //   pannable: true\n      // }\n    });\n    // 使用插件形式的snapline\n    this.graph.use(\n      new Snapline({\n        enabled: true,\n        sharp: true\n      })\n    );\n    // this.graph.use(\n    //   new Scroller({\n    //     enabled: true,\n    //     pageVisible: true,\n    //     pageBreak: true,\n    //     pannable: true\n    //   })\n    // );\n    this.graph.fromJSON(MOCKDATA);\n\n    // this.graph.on(\"cell:dblclick\", (options: any) => {\n    //     const { cell, e } = options\n    //     cell.addTools({\n    //         name: cell.isEdge() ? 'edge-editor' : 'node-editor',\n    //         args: {\n    //             event: e,\n    //         },\n    //     })\n    // })\n\n    this.stencil = new Stencil({\n      title: '业务组件库',\n      target: this.graph,\n      search(cell, keyword) {\n        return cell.shape.indexOf(keyword) !== -1;\n      },\n      placeholder: '请输入组件名称',\n      notFoundText: '未搜索到指定的组件',\n      collapsable: true,\n      stencilGraphWidth: 200,\n      stencilGraphHeight: 180,\n      groups: [\n        {\n          name: 'trigger',\n          title: '触发',\n          graphHeight: 100,\n          graphOptions: {}\n        },\n        {\n          name: 'flow',\n          title: '流程控制',\n          collapsed: true\n        },\n        {\n          name: 'strategy',\n          title: '策略',\n          collapsed: true\n        },\n        {\n          name: 'actions',\n          title: '动作',\n          collapsed: true\n        },\n        {\n          name: 'productions',\n          title: '数据产品',\n          collapsed: true\n        }\n      ],\n      getDragNode: (node: any, options: any) => {\n        console.log('getDragNode====>', node, options);\n        return node.clone();\n      },\n      getDropNode: (node: any, options: any) => {\n        console.log('getDropNode=====>', node, options);\n        const ports = [\n          {\n            id: 'port1',\n            attrs: {\n              circle: {\n                magnet: true\n              }\n            }\n          },\n          {\n            id: 'port2',\n            attrs: {\n              circle: {\n                magnet: true\n              }\n            }\n          }\n        ];\n\n        const newNode = node.clone().size({\n          width: 240,\n          height: 80\n        });\n        newNode.addPorts(ports);\n        return newNode;\n      }\n    });\n\n    if (this.stencilContainer) {\n      this.stencilContainer.appendChild(this.stencil.container);\n    }\n    // 业务组件栏的组件实例\n    const r = new Rect({\n      width: 70,\n      height: 40,\n      attrs: {\n        rect: { fill: '#31D0C6', stroke: '#4B4A67', strokeWidth: 6 },\n        text: { text: 'rect', fill: 'white' }\n      }\n    });\n\n    const c = new Circle({\n      width: 60,\n      height: 60,\n      data: {\n        data: 'myData'\n      },\n      attrs: {\n        circle: { fill: '#FE854F', strokeWidth: 6, stroke: '#4B4A67' },\n        text: { text: 'ellipse', fill: 'white' }\n      }\n    });\n\n    const c2 = new Circle({\n      width: 60,\n      height: 60,\n      attrs: {\n        circle: { fill: '#4B4A67', 'stroke-width': 6, stroke: '#FE854F' },\n        text: { text: 'ellipse', fill: 'white' }\n      }\n    });\n\n    const r2 = new Rect({\n      width: 70,\n      height: 40,\n      attrs: {\n        rect: { fill: '#4B4A67', stroke: '#31D0C6', strokeWidth: 6 },\n        text: { text: 'rect', fill: 'white' }\n      }\n    });\n\n    const r3 = new Rect({\n      width: 70,\n      height: 40,\n      attrs: {\n        rect: { fill: '#31D0C6', stroke: '#4B4A67', strokeWidth: 6 },\n        text: { text: 'rect', fill: 'white' }\n      }\n    });\n\n    const c3 = new Circle({\n      width: 60,\n      height: 60,\n      attrs: {\n        circle: { fill: '#FE854F', strokeWidth: 6, stroke: '#4B4A67' },\n        text: { text: 'ellipse', fill: 'white' }\n      },\n      ports: [\n        {\n          id: 'port1',\n          attrs: {\n            circle: {\n              magnet: true\n            }\n          }\n        },\n        {\n          id: 'port2',\n          attrs: {\n            circle: {\n              magnet: true\n            }\n          }\n        }\n      ]\n    });\n\n    const customNode = {\n      shape: 'react-shape',\n      width: 60,\n      height: 60,\n      component: <Trigger />\n    };\n\n    this.stencil.load([r, c, customNode], 'trigger');\n    this.stencil.load([c2.clone(), r2, r3, c3], 'flow');\n  }\n\n  componentDidUpdate() {\n    // const { node } = this.state;\n    console.log('didUpdate========>', this.state);\n    // if (node !== null) {\n    //     this.graph?.addNode(node)\n    // }\n  }\n\n  refContainer = (container: HTMLDivElement) => {\n    this.container = container;\n  };\n\n  refStencil = (stencil: HTMLDivElement) => {\n    this.stencilContainer = stencil;\n  };\n\n  onGetAll = () => {\n    if (this.graph) {\n      const all = this.graph.getCells();\n      console.log('cells======>', all);\n    }\n  };\n\n  onAutoLayout = () => {\n    const step = 200;\n    const level = 50;\n    const elemWidth = 80;\n    const elemHeight = 40;\n\n    if (this.graph) {\n      const rootNode = this.graph.getRootNodes();\n      if (rootNode.length === 1) {\n        const root = rootNode[0];\n        /*\n            深度depth到元素个数count的映射，用于计算位置\n        */\n        const depthMap = new Map([]);\n        // 获取叶子节点个数\n        const leafCount = this.graph.getLeafNodes();\n        console.log('leafCount===>', leafCount.length);\n        let prevChildren = this.graph?.getNeighbors(root, {\n          outgoing: true\n        }); // 前置节点的子节点个数\n        this.graph.searchCell(\n          root,\n          (cell: Cell, distance: number) => {\n            if (distance === 0) {\n              // 根节点，直接设置坐标(0, 0)\n              if (cell.isNode()) {\n                cell.position(0, 0);\n              }\n            } else {\n              if (cell.isNode()) {\n                // 非根节点，根据父节点坐标和兄弟节点个数计算坐标\n                // 获取当前节点的父节点\n                const offset = ((level + elemHeight) * prevChildren.length) / 2;\n                console.log('offset====>', offset);\n                const prev = this.graph?.getPredecessors(cell, {\n                  breadthFirst: true,\n                  distance: 1\n                });\n                let parent = null;\n                let parentPosition: any = {};\n                if (Array.isArray(prev)) {\n                  parent = prev[prev.length - 1];\n                }\n                if (parent?.isNode()) {\n                  parentPosition = parent.position();\n                }\n                console.log(\n                  'cell====>',\n                  cell,\n                  parent,\n                  prevChildren,\n                  parentPosition\n                );\n                let count: any = depthMap.get(distance);\n                if (count === undefined) {\n                  count = 1;\n                } else {\n                  count = count + 1;\n                }\n                depthMap.set(distance, count);\n                const x = parentPosition.x + elemWidth + step;\n                const y =\n                  parentPosition.y + (elemWidth + level) * (count - 1) - offset;\n\n                cell.position(x, y);\n              }\n            }\n          },\n          {\n            breadthFirst: true,\n            outgoing: true\n          }\n        );\n      }\n    }\n  };\n\n  render() {\n    return (\n      <div className={styles.x6dnd}>\n        <div className={styles.component}>\n          <Trigger />\n        </div>\n        <div className={styles.wrapper} style={{ width: '100%' }}>\n          <div className={styles.stencil} ref={this.refStencil}></div>\n          <div className={styles.container}>\n            <Toolbar className={styles.toolbar}>\n              <Group>\n                <Item name=\"zoomIn\" tooltip=\"缩小\" icon=\"\">\n                  缩小\n                </Item>\n                <Item name=\"zoomOut\" tooltip=\"放大\" icon=\"\">\n                  放大\n                </Item>\n                <Item\n                  name=\"auto\"\n                  tooltip=\"自动布局\"\n                  onClick={this.onAutoLayout}\n                  icon=\"\">\n                  自动布局\n                </Item>\n              </Group>\n              <Group>\n                <Item name=\"all\" tooltip=\"获取节点\" onClick={this.onGetAll}>\n                  获取节点\n                </Item>\n              </Group>\n            </Toolbar>\n            <div className={styles.graph} ref={this.refContainer}></div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n","import * as React from \"react\";\nimport { connect } from \"react-redux\";\nimport X6DndGraph from './components/X6DndGraph'\n\ninterface IX6Props {\n    logs: {}\n    groupList: any[]\n}\n\nclass X6 extends React.Component<IX6Props, never> {\n    render() {\n        return (\n            <div style={{ width: '100%', height: '100%', overflow: 'auto' }}>\n                <X6DndGraph />\n            </div>\n        )\n    }\n}\n\nexport default connect((state: any) => {\n    const { x6 } = state\n\n    return x6\n})(X6)"],"sourceRoot":""}